# コードレビュールール

## 基本原則

実装完了後、**必ずレビュー専用サブエージェントによるレビューを実施する。**

---

## レビュープロセス

### 1. レビュータスクの記録（メインエージェント）

レビュー依頼前に、`.claude/docs/dashboard.md` の「メインエージェント → サブエージェント」セクションに以下を記載:
- タスクステータス: レビュー依頼中
- 対象ファイル: レビュー対象のファイルパス
- 変更内容: 実装内容のサマリー
- 追加指示: 特別な注意点

### 2. レビューサブエージェントの起動

メインエージェントが実装完了後、Task toolで `.claude/agents/` 配下のレビューエージェントを呼び出す。

**命名規則**: `xxx_reviewer.md`
- 例: `code_reviewer.md`, `typescript_reviewer.md`

### 3. dashboard.mdの確認（サブエージェント）

サブエージェントは起動時に `.claude/docs/dashboard.md` を読み取り、レビュー対象と指示内容を確認する。

### 4. レビュー実行項目

レビューサブエージェントは以下を実施:

#### 必須チェック項目
- ✅ テスト実行（`pnpm test`）
- ✅ テストカバレッジ確認
- ✅ Lintチェック（`pnpm lint`）
- ✅ 型チェック（`pnpm typecheck`）
- ✅ ビルド確認（`pnpm build`）

#### コード品質評価
- **保守性**: コードの可読性、拡張性、保守しやすさ
- **安全性**: セキュリティ脆弱性、エラーハンドリング
- **パフォーマンス**: 非効率なコード、N+1クエリ等

### 5. レビュー結果のdashboard.md記載（サブエージェント）

レビュー完了後、`.claude/docs/dashboard.md` の「サブエージェント → メインエージェント」セクションに結果を記載:
- レビュー結果ステータス: 完了
- 実行結果: テスト・Lint・型チェック・ビルドの結果
- 問題点: 発見した問題のリスト
- 推奨事項: 改善提案

### 6. レビュー結果の返却形式（参考）

テスト実行結果（✅/❌、カバレッジ）、Lint/型チェック（✅/❌）、ビルド（✅/❌）、コード品質評価（保守性・安全性・パフォーマンス）、改善提案をdashboard.mdに記載。

### 7. dashboard.mdの確認と対応（メインエージェント）

メインエージェントは `.claude/docs/dashboard.md` の「サブエージェント → メインエージェント」セクションを確認:
1. ❌ 問題があれば修正を行う
2. ✅ すべてのチェックがパスしたら、ユーザーに報告して承認を求める
3. 完了後、履歴に記録して現在のタスクセクションをクリア

---

## ユーザー承認プロセス

### 必須ルール

**ユーザーの明示的な承認なしに、以下の変更を反映してはならない:**

- コードの変更（新規作成・編集・削除）
- 依存パッケージの追加・削除・更新
- 設定ファイルの変更
- データベーススキーマの変更
- デプロイ・リリース操作

### 承認フロー

1. **変更内容の提示**: 何を変更するか明確に説明
2. **テスト結果の提示**: すべてのテスト・チェックがパスしていることを確認
3. **ユーザーの承認待ち**: 明示的に承認を求める
4. **承認後に反映**: ユーザーが承認したら変更を反映

### 承認を求める際の表記

変更内容のサマリー、レビュー結果（テスト・Lint・型チェック・ビルド・品質評価）を提示し、「この変更を反映してよろしいですか？」と明示的に承認を求める。

---

## まとめ

実装 → レビュー依頼（dashboard.mdにタスク指示）→ レビュー実行（テスト・Lint・型チェック・ビルド・品質評価）→ 結果記載（dashboard.md）→ 修正 or ユーザー承認 → 履歴記録 → 反映

**すべての実装工程でこのレビュープロセスを遵守すること。**
